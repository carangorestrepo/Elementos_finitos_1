function Kloc=k_viga3d(L,EA,GJ,Acy,Acz,EIz,EIy,tipo)
if tipo==1
    %% viga empotrada empoetrada %%%%%%%%%%%%%%%%
    Kloc=[[  EA/L,                                    0,                                    0,     0,                                                   0,                                                   0, -EA/L,                                    0,                                    0,     0,                                                   0,                                                   0];
          [     0,  (12*Acy*EIz)/(L*(Acy*L^2 + 12*EIz)),                                    0,     0,                                                   0,                      (6*Acy*EIz)/(Acy*L^2 + 12*EIz),     0, -(12*Acy*EIz)/(L*(Acy*L^2 + 12*EIz)),                                    0,     0,                                                   0,                      (6*Acy*EIz)/(Acy*L^2 + 12*EIz)];
          [     0,                                    0,  (12*Acz*EIy)/(L*(Acz*L^2 + 12*EIy)),     0,                     -(6*Acz*EIy)/(Acz*L^2 + 12*EIy),                                                   0,     0,                                    0, -(12*Acz*EIy)/(L*(Acz*L^2 + 12*EIy)),     0,                     -(6*Acz*EIy)/(Acz*L^2 + 12*EIy),                                                   0];
          [     0,                                    0,                                    0,  GJ/L,                                                   0,                                                   0,     0,                                    0,                                    0, -GJ/L,                                                   0,                                                   0];
          [     0,                                    0,      -(6*Acz*EIy)/(Acz*L^2 + 12*EIy),     0,    (4*EIy*(Acz*L^2 + 3*EIy))/(L*(Acz*L^2 + 12*EIy)),                                                   0,     0,                                    0,       (6*Acz*EIy)/(Acz*L^2 + 12*EIy),     0, -(2*EIy*(- Acz*L^2 + 6*EIy))/(L*(Acz*L^2 + 12*EIy)),                                                   0];
          [     0,       (6*Acy*EIz)/(Acy*L^2 + 12*EIz),                                    0,     0,                                                   0,    (4*EIz*(Acy*L^2 + 3*EIz))/(L*(Acy*L^2 + 12*EIz)),     0,      -(6*Acy*EIz)/(Acy*L^2 + 12*EIz),                                    0,     0,                                                   0, -(2*EIz*(- Acy*L^2 + 6*EIz))/(L*(Acy*L^2 + 12*EIz))];
          [ -EA/L,                                    0,                                    0,     0,                                                   0,                                                   0,  EA/L,                                    0,                                    0,     0,                                                   0,                                                   0];
          [     0, -(12*Acy*EIz)/(L*(Acy*L^2 + 12*EIz)),                                    0,     0,                                                   0,                     -(6*Acy*EIz)/(Acy*L^2 + 12*EIz),     0,  (12*Acy*EIz)/(L*(Acy*L^2 + 12*EIz)),                                    0,     0,                                                   0,                     -(6*Acy*EIz)/(Acy*L^2 + 12*EIz)];
          [     0,                                    0, -(12*Acz*EIy)/(L*(Acz*L^2 + 12*EIy)),     0,                      (6*Acz*EIy)/(Acz*L^2 + 12*EIy),                                                   0,     0,                                    0,  (12*Acz*EIy)/(L*(Acz*L^2 + 12*EIy)),     0,                      (6*Acz*EIy)/(Acz*L^2 + 12*EIy),                                                   0];
          [     0,                                    0,                                    0, -GJ/L,                                                   0,                                                   0,     0,                                    0,                                    0,  GJ/L,                                                   0,                                                   0];
          [     0,                                    0,      -(6*Acz*EIy)/(Acz*L^2 + 12*EIy),     0, -(2*EIy*(- Acz*L^2 + 6*EIy))/(L*(Acz*L^2 + 12*EIy)),                                                   0,     0,                                    0,       (6*Acz*EIy)/(Acz*L^2 + 12*EIy),     0,    (4*EIy*(Acz*L^2 + 3*EIy))/(L*(Acz*L^2 + 12*EIy)),                                                   0];
          [     0,       (6*Acy*EIz)/(Acy*L^2 + 12*EIz),                                    0,     0,                                                   0, -(2*EIz*(- Acy*L^2 + 6*EIz))/(L*(Acy*L^2 + 12*EIz)),     0,      -(6*Acy*EIz)/(Acy*L^2 + 12*EIz),                                    0,     0,                                                   0,    (4*EIz*(Acy*L^2 + 3*EIz))/(L*(Acy*L^2 + 12*EIz))]];
elseif tipo==2
    %% nudos rigidos NR
   % Kloc =[[  (A*E)/L,                                                                                                                                                    0,                                                                                                                                                   0,        0,                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                   0, -(A*E)/L,                                                                                                                                                   0,                                                                                                                                                    0,        0,                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                   0];
   %        [        0,              -(12*A*E*G*Iyz*ks)/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),                                                                                                                                                   0,        0,                                                                                                                                                                                                                                   0,                                                                                -(6*A*E*G*Iyz*ks*(L + la - lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),        0,              (12*A*E*G*Iyz*ks)/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),                                                                                                                                                    0,        0,                                                                                                                                                                                                                                   0,                                                                                -(6*A*E*G*Iyz*ks*(L - la + lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz))];
   %        [        0,                                                                                                                                                    0,             -(12*A*E*G*Ixz*ks)/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),        0,                                                                                 (6*A*E*G*Ixz*ks*(L + la - lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),                                                                                                                                                                                                                                   0,        0,                                                                                                                                                   0,               (12*A*E*G*Ixz*ks)/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),        0,                                                                                 (6*A*E*G*Ixz*ks*(L - la + lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),                                                                                                                                                                                                                                   0];
   %        [        0,                                                                                                                                                    0,                                                                                                                                                   0,  (G*J)/L,                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                   0,        0,                                                                                                                                                   0,                                                                                                                                                    0, -(G*J)/L,                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                   0];
   %        [        0,                                                                                                                                                    0, (6*A*E*G*Ixz*ks*(L + la - lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),        0,     -(4*E*Ixz*(A*G*ks*L^2 + A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 - A*G*ks*la*lb + A*G*ks*lb^2 + 3*E*Ixz))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),                                                                                                                                                                                                                                   0,        0,                                                                                                                                                   0, -(6*A*E*G*Ixz*ks*(L + la - lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),        0, -(2*E*Ixz*(A*G*ks*L^2 + A*G*ks*L*la + A*G*ks*L*lb - 2*A*G*ks*la^2 + 2*A*G*ks*la*lb - 2*A*G*ks*lb^2 - 6*E*Ixz))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),                                                                                                                                                                                                                                   0];
   %        [        0, -(6*A*E*G*Iyz*ks*(L + la - lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),                                                                                                                                                   0,        0,                                                                                                                                                                                                                                   0,     -(4*E*Iyz*(A*G*ks*L^2 + A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 - A*G*ks*la*lb + A*G*ks*lb^2 + 3*E*Iyz))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),        0, (6*A*E*G*Iyz*ks*(L + la - lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),                                                                                                                                                    0,        0,                                                                                                                                                                                                                                   0, -(2*E*Iyz*(A*G*ks*L^2 + A*G*ks*L*la + A*G*ks*L*lb - 2*A*G*ks*la^2 + 2*A*G*ks*la*lb - 2*A*G*ks*lb^2 - 6*E*Iyz))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz))];
   %        [ -(A*E)/L,                                                                                                                                                    0,                                                                                                                                                   0,        0,                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                   0,  (A*E)/L,                                                                                                                                                   0,                                                                                                                                                    0,        0,                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                   0];
   %        [        0,               (12*A*E*G*Iyz*ks)/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),                                                                                                                                                   0,        0,                                                                                                                                                                                                                                   0,                                                                                 (6*A*E*G*Iyz*ks*(L + la - lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),        0,             -(12*A*E*G*Iyz*ks)/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),                                                                                                                                                    0,        0,                                                                                                                                                                                                                                   0,                                                                                 (6*A*E*G*Iyz*ks*(L - la + lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz))];
   %        [        0,                                                                                                                                                    0,              (12*A*E*G*Ixz*ks)/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),        0,                                                                                -(6*A*E*G*Ixz*ks*(L + la - lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),                                                                                                                                                                                                                                   0,        0,                                                                                                                                                   0,              -(12*A*E*G*Ixz*ks)/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),        0,                                                                                -(6*A*E*G*Ixz*ks*(L - la + lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),                                                                                                                                                                                                                                   0];
   %        [        0,                                                                                                                                                    0,                                                                                                                                                   0, -(G*J)/L,                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                   0,        0,                                                                                                                                                   0,                                                                                                                                                    0,  (G*J)/L,                                                                                                                                                                                                                                   0,                                                                                                                                                                                                                                   0];
   %        [        0,                                                                                                                                                    0, (6*A*E*G*Ixz*ks*(L - la + lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),        0, -(2*E*Ixz*(A*G*ks*L^2 + A*G*ks*L*la + A*G*ks*L*lb - 2*A*G*ks*la^2 + 2*A*G*ks*la*lb - 2*A*G*ks*lb^2 - 6*E*Ixz))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),                                                                                                                                                                                                                                   0,        0,                                                                                                                                                   0, -(6*A*E*G*Ixz*ks*(L - la + lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),        0,     -(4*E*Ixz*(A*G*ks*L^2 - 2*A*G*ks*L*la + A*G*ks*L*lb + A*G*ks*la^2 - A*G*ks*la*lb + A*G*ks*lb^2 + 3*E*Ixz))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Ixz)),                                                                                                                                                                                                                                   0];
   %        [        0, -(6*A*E*G*Iyz*ks*(L - la + lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),                                                                                                                                                   0,        0,                                                                                                                                                                                                                                   0, -(2*E*Iyz*(A*G*ks*L^2 + A*G*ks*L*la + A*G*ks*L*lb - 2*A*G*ks*la^2 + 2*A*G*ks*la*lb - 2*A*G*ks*lb^2 - 6*E*Iyz))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),        0, (6*A*E*G*Iyz*ks*(L - la + lb))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz)),                                                                                                                                                    0,        0,                                                                                                                                                                                                                                   0,     -(4*E*Iyz*(A*G*ks*L^2 - 2*A*G*ks*L*la + A*G*ks*L*lb + A*G*ks*la^2 - A*G*ks*la*lb + A*G*ks*lb^2 + 3*E*Iyz))/((la - L + lb)*(A*G*ks*L^2 - 2*A*G*ks*L*la - 2*A*G*ks*L*lb + A*G*ks*la^2 + 2*A*G*ks*la*lb + A*G*ks*lb^2 + 12*E*Iyz))]];  
     Kloc =[[  EA/L,                                                                                                                          0,                                                                                                                           0,     0,                                                                                                                                                                                         0,                                                                                                                                                                                         0, -EA/L,                                                                                                                           0,                                                                                                                          0,     0,                                                                                                                                                                                         0,                                                                                                                                                                                         0];
            [     0,              (12*Acy*EIz)/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),                                                                                                                           0,     0,                                                                                                                                                                                         0,                                                                (6*Acy*EIz*(L + la - lb))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),     0,              -(12*Acy*EIz)/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),                                                                                                                          0,     0,                                                                                                                                                                                         0,                                                                (6*Acy*EIz*(L + la - lb))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz))];
            [     0,                                                                                                                          0,               (12*Acz*EIy)/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),     0,                                                               -(6*Acz*EIy*(L + la - lb))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),                                                                                                                                                                                         0,     0,                                                                                                                           0,             -(12*Acz*EIy)/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),     0,                                                               -(6*Acz*EIy*(L + la - lb))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),                                                                                                                                                                                         0];
            [     0,                                                                                                                          0,                                                                                                                           0,  GJ/L,                                                                                                                                                                                         0,                                                                                                                                                                                         0,     0,                                                                                                                           0,                                                                                                                          0, -GJ/L,                                                                                                                                                                                         0,                                                                                                                                                                                         0];
            [     0,                                                                                                                          0, -(6*Acz*EIy*(L + la - lb))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),     0,      (4*EIy*(Acz*L^2 + Acz*L*la - 2*Acz*L*lb + Acz*la^2 - Acz*la*lb + Acz*lb^2 + 3*EIy))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),                                                                                                                                                                                         0,     0,                                                                                                                           0, (6*Acz*EIy*(L + la - lb))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),     0, -(2*EIy*(Acz*L^2 + Acz*L*la + Acz*L*lb - 2*Acz*la^2 + 2*Acz*la*lb - 2*Acz*lb^2 - 6*EIy))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),                                                                                                                                                                                         0];
            [     0, (6*Acy*EIz*(L + la - lb))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),                                                                                                                           0,     0,                                                                                                                                                                                         0,      (4*EIz*(Acy*L^2 + Acy*L*la - 2*Acy*L*lb + Acy*la^2 - Acy*la*lb + Acy*lb^2 + 3*EIz))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),     0, -(6*Acy*EIz*(L + la - lb))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),                                                                                                                          0,     0,                                                                                                                                                                                         0, -(2*EIz*(Acy*L^2 + Acy*L*la + Acy*L*lb - 2*Acy*la^2 + 2*Acy*la*lb - 2*Acy*lb^2 - 6*EIz))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz))];
            [ -EA/L,                                                                                                                          0,                                                                                                                           0,     0,                                                                                                                                                                                         0,                                                                                                                                                                                         0,  EA/L,                                                                                                                           0,                                                                                                                          0,     0,                                                                                                                                                                                         0,                                                                                                                                                                                         0];
            [     0,             -(12*Acy*EIz)/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),                                                                                                                           0,     0,                                                                                                                                                                                         0,                                                               -(6*Acy*EIz*(L + la - lb))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),     0,               (12*Acy*EIz)/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),                                                                                                                          0,     0,                                                                                                                                                                                         0,                                                               -(6*Acy*EIz*(L + la - lb))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz))];
            [     0,                                                                                                                          0,              -(12*Acz*EIy)/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),     0,                                                                (6*Acz*EIy*(L + la - lb))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),                                                                                                                                                                                         0,     0,                                                                                                                           0,              (12*Acz*EIy)/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),     0,                                                                (6*Acz*EIy*(L + la - lb))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),                                                                                                                                                                                         0];
            [     0,                                                                                                                          0,                                                                                                                           0, -GJ/L,                                                                                                                                                                                         0,                                                                                                                                                                                         0,     0,                                                                                                                           0,                                                                                                                          0,  GJ/L,                                                                                                                                                                                         0,                                                                                                                                                                                         0];
            [     0,                                                                                                                          0, -(6*Acz*EIy*(L + la - lb))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),     0, -(2*EIy*(Acz*L^2 + Acz*L*la + Acz*L*lb - 2*Acz*la^2 + 2*Acz*la*lb - 2*Acz*lb^2 - 6*EIy))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),                                                                                                                                                                                         0,     0,                                                                                                                           0, (6*Acz*EIy*(L + la - lb))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),     0,      (4*EIy*(Acz*L^2 + Acz*L*la - 2*Acz*L*lb + Acz*la^2 - Acz*la*lb + Acz*lb^2 + 3*EIy))/((la - L + lb)*(Acz*L^2 - 2*Acz*L*la - 2*Acz*L*lb + Acz*la^2 + 2*Acz*la*lb + Acz*lb^2 + 12*EIy)),                                                                                                                                                                                         0];
            [     0, (6*Acy*EIz*(L + la - lb))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),                                                                                                                           0,     0,                                                                                                                                                                                         0, -(2*EIz*(Acy*L^2 + Acy*L*la + Acy*L*lb - 2*Acy*la^2 + 2*Acy*la*lb - 2*Acy*lb^2 - 6*EIz))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),     0, -(6*Acy*EIz*(L + la - lb))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz)),                                                                                                                          0,     0,                                                                                                                                                                                         0,      (4*EIz*(Acy*L^2 + Acy*L*la - 2*Acy*L*lb + Acy*la^2 - Acy*la*lb + Acy*lb^2 + 3*EIz))/((la - L + lb)*(Acy*L^2 - 2*Acy*L*la - 2*Acy*L*lb + Acy*la^2 + 2*Acy*la*lb + Acy*lb^2 + 12*EIz))]];  
elseif tipo==3   
    %% viga apoyada empotrada RE
   Kloc=[[  EA/L,                                  0,                                  0,     0, 0, 0, -EA/L,                                  0,                                  0,     0,                               0,                               0];
         [     0,  (3*Acy*EIz)/(L*(Acy*L^2 + 3*EIz)),                                  0,     0, 0, 0,     0, -(3*Acy*EIz)/(L*(Acy*L^2 + 3*EIz)),                                  0,     0,                               0,   (3*Acy*EIz)/(Acy*L^2 + 3*EIz)];
         [     0,                                  0,  (3*Acz*EIy)/(L*(Acz*L^2 + 3*EIy)),     0, 0, 0,     0,                                  0, -(3*Acz*EIy)/(L*(Acz*L^2 + 3*EIy)),     0,  -(3*Acz*EIy)/(Acz*L^2 + 3*EIy),                               0];
         [     0,                                  0,                                  0,  GJ/L, 0, 0,     0,                                  0,                                  0, -GJ/L,                               0,                               0];
         [     0,                                  0,                                  0,     0, 0, 0,     0,                                  0,                                  0,     0,                               0,                               0];
         [     0,                                  0,                                  0,     0, 0, 0,     0,                                  0,                                  0,     0,                               0,                               0];
         [ -EA/L,                                  0,                                  0,     0, 0, 0,  EA/L,                                  0,                                  0,     0,                               0,                               0];
         [     0, -(3*Acy*EIz)/(L*(Acy*L^2 + 3*EIz)),                                  0,     0, 0, 0,     0,  (3*Acy*EIz)/(L*(Acy*L^2 + 3*EIz)),                                  0,     0,                               0,  -(3*Acy*EIz)/(Acy*L^2 + 3*EIz)];
         [     0,                                  0, -(3*Acz*EIy)/(L*(Acz*L^2 + 3*EIy)),     0, 0, 0,     0,                                  0,  (3*Acz*EIy)/(L*(Acz*L^2 + 3*EIy)),     0,   (3*Acz*EIy)/(Acz*L^2 + 3*EIy),                               0];
         [     0,                                  0,                                  0, -GJ/L, 0, 0,     0,                                  0,                                  0,  GJ/L,                               0,                               0];
         [     0,                                  0,     -(3*Acz*EIy)/(Acz*L^2 + 3*EIy),     0, 0, 0,     0,                                  0,      (3*Acz*EIy)/(Acz*L^2 + 3*EIy),     0, (3*Acz*EIy*L)/(Acz*L^2 + 3*EIy),                               0];
         [     0,      (3*Acy*EIz)/(Acy*L^2 + 3*EIz),                                  0,     0, 0, 0,     0,     -(3*Acy*EIz)/(Acy*L^2 + 3*EIz),                                  0,     0,                               0, (3*Acy*EIz*L)/(Acy*L^2 + 3*EIz)]];
elseif tipo==4
  %% viga empotrada apoyada  ER
  Kloc=[[  EA/L,                                  0,                                  0,     0,                               0,                               0, -EA/L,                                  0,                                  0,     0, 0, 0];
        [     0,  (3*Acy*EIz)/(L*(Acy*L^2 + 3*EIz)),                                  0,     0,                               0,   (3*Acy*EIz)/(Acy*L^2 + 3*EIz),     0, -(3*Acy*EIz)/(L*(Acy*L^2 + 3*EIz)),                                  0,     0, 0, 0];
        [     0,                                  0,  (3*Acz*EIy)/(L*(Acz*L^2 + 3*EIy)),     0,  -(3*Acz*EIy)/(Acz*L^2 + 3*EIy),                               0,     0,                                  0, -(3*Acz*EIy)/(L*(Acz*L^2 + 3*EIy)),     0, 0, 0];
        [     0,                                  0,                                  0,  GJ/L,                               0,                               0,     0,                                  0,                                  0, -GJ/L, 0, 0];
        [     0,                                  0,     -(3*Acz*EIy)/(Acz*L^2 + 3*EIy),     0, (3*Acz*EIy*L)/(Acz*L^2 + 3*EIy),                               0,     0,                                  0,      (3*Acz*EIy)/(Acz*L^2 + 3*EIy),     0, 0, 0];
        [     0,      (3*Acy*EIz)/(Acy*L^2 + 3*EIz),                                  0,     0,                               0, (3*Acy*EIz*L)/(Acy*L^2 + 3*EIz),     0,     -(3*Acy*EIz)/(Acy*L^2 + 3*EIz),                                  0,     0, 0, 0];
        [ -EA/L,                                  0,                                  0,     0,                               0,                               0,  EA/L,                                  0,                                  0,     0, 0, 0];
        [     0, -(3*Acy*EIz)/(L*(Acy*L^2 + 3*EIz)),                                  0,     0,                               0,  -(3*Acy*EIz)/(Acy*L^2 + 3*EIz),     0,  (3*Acy*EIz)/(L*(Acy*L^2 + 3*EIz)),                                  0,     0, 0, 0];
        [     0,                                  0, -(3*Acz*EIy)/(L*(Acz*L^2 + 3*EIy)),     0,   (3*Acz*EIy)/(Acz*L^2 + 3*EIy),                               0,     0,                                  0,  (3*Acz*EIy)/(L*(Acz*L^2 + 3*EIy)),     0, 0, 0];
        [     0,                                  0,                                  0, -GJ/L,                               0,                               0,     0,                                  0,                                  0,  GJ/L, 0, 0];
        [     0,                                  0,                                  0,     0,                               0,                               0,     0,                                  0,                                  0,     0, 0, 0];
        [     0,                                  0,                                  0,     0,                               0,                               0,     0,                                  0,                                  0,     0, 0, 0]];
elseif tipo==5
  %% viga eapoyada apoyada  RR
  Kloc=[[  EA/L, 0, 0,     0, 0, 0, -EA/L, 0, 0,     0, 0, 0];
        [     0, 0, 0,     0, 0, 0,     0, 0, 0,     0, 0, 0];
        [     0, 0, 0,     0, 0, 0,     0, 0, 0,     0, 0, 0];
        [     0, 0, 0,  GJ/L, 0, 0,     0, 0, 0, -GJ/L, 0, 0];
        [     0, 0, 0,     0, 0, 0,     0, 0, 0,     0, 0, 0];
        [     0, 0, 0,     0, 0, 0,     0, 0, 0,     0, 0, 0];
        [ -EA/L, 0, 0,     0, 0, 0,  EA/L, 0, 0,     0, 0, 0];
        [     0, 0, 0,     0, 0, 0,     0, 0, 0,     0, 0, 0];
        [     0, 0, 0,     0, 0, 0,     0, 0, 0,     0, 0, 0];
        [     0, 0, 0, -GJ/L, 0, 0,     0, 0, 0,  GJ/L, 0, 0];
        [     0, 0, 0,     0, 0, 0,     0, 0, 0,     0, 0, 0];
        [     0, 0, 0,     0, 0, 0,     0, 0, 0,     0, 0, 0]];
end
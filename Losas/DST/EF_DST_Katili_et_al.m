D=E*h^3/(12*(1-nu^2));
Ds=5/6*G*h;
G=E/(2*(1-nu));

xe = xnod(LaG(e,:),X);       ye = xnod(LaG(e,:),Y);
x21 = xe(2) - xe(1);         y21 = ye(2) - ye(1); 
x32 = xe(3) - xe(2);         y32 = ye(3) - ye(2);
x13 = xe(1) - xe(3);         y13 = ye(1) - ye(3);   

Ae=(-x21*y13+x13*y21)/2;

tj=1/(4*A^2)*[y13^2  ,y21^2   ,-2*y13*y21;
              x13^2  ,x21^2   ,-2*x13*x21;
             -y13*x13,-y21*x21,-y13*x21+y21*x13];
tz=zeros(3);

Hs=Ds*[1,0;
       0,1];
H =  D* [  1     nu   0
            nu    1    0
            0     0   (1-nu)/2];
Tj=[tz,tj
    tj,tz];

Talfa= [-8*C4,   0,0;
             0,   0,-8*C6;
         -4*C4,4*C5,-4*C6; 
         -8*S4,   0,0;
             0,   0,-8*S6;
         -4*S4,4*S5,-4*S6];

L=-2/3*[L4,0,0;
        0,L5,0;
        0,0,L6];
C=2/3*[1                ,1/3*(C4*C5+S4*S5),1/3*(C4*C6+S4*S6);
       1/3*(C4*C5+S4*S5),1                ,1/3*(C5*C6+S5*S6);
       1/3*(C4*C6+S4*S6),1/3*(C5*C6+S5*S6),1                ];
   
Aalfas=[L4*C4,L4*S4;
        L5*C5,L5*S5;
        L6*C6,L6*S6];
          
Hbm=[H(1,1),H(3,3),2*H(1,3)     ,H(1,3),H(2,3),H(1,2)+H(3,3);
     H(1,3),H(2,3),H(1,2)+H(3,3),H(3,3),H(2,2),2*H(2,3)     ];
 
%Hbm=[1,(1-nu)/2,       0,       0,0,(1+nu)/2;
%     0,       0,(1+nu)/2,(1-nu)/2,1,       0]; 
 
 
Aw=1/2*[2,x12,y12,-2,x12 ,y12,0 ,0  ,0;
        0,  0,  0, 2, x23,y23,-2,x23,y23;
       -2,x31,y31, 0,   0,  0, 2,x31,y31];
 
Bsalfa=Hs^-1*Hbm*Tj*Talfa;
Aalfab=L*C;
Aalfa=Aalfab-Aalfas;
An=Aalfa^(-1)*Aw;
ksalfa=Ae*Bsalfa'*Hs*Bsalfa;
Ks=An'*ksalfa*An;